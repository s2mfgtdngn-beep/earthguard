<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EarthGuard Tactical Console</title>

<style>
:root {
  --bg: #0b0f14;
  --panel: #121821;
  --panel-2: #0f141c;
  --text: #d6dde5;
  --muted: #6e7a86;
  --accent: #3aa675;
  --danger: #c94c4c;
  --border: #1f2a36;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  background: var(--bg);
  font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
  color: var(--text);
}

.wrapper {
  max-width: 1200px;
  margin: 0 auto;
  padding: 32px 24px 80px;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 28px;
}

h1 {
  font-size: 18px;
  letter-spacing: 2px;
  font-weight: 600;
  color: var(--accent);
  margin: 0;
}

.status {
  font-size: 12px;
  color: var(--muted);
}

.panel {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 20px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

thead {
  background: var(--panel-2);
}

th {
  font-size: 11px;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--muted);
  text-align: left;
  padding: 14px 10px;
  border-bottom: 1px solid var(--border);
}

td {
  padding: 14px 10px;
  border-bottom: 1px solid var(--border);
  font-size: 13px;
  font-variant-numeric: tabular-nums;
}

tr:hover {
  background: #10161f;
  cursor: pointer;
}

.hazard {
  color: var(--danger);
}

.detail-row {
  background: #0f141c;
}

.detail-content {
  padding: 16px 10px;
  font-size: 12px;
  color: var(--muted);
  line-height: 1.6;
}

footer {
  margin-top: 40px;
  font-size: 11px;
  color: var(--muted);
}
</style>
</head>

<body>

<div class="wrapper">

<header>
  <h1>EARTHGUARD TACTICAL CONSOLE</h1>
  <div class="status" id="status">Initializing...</div>
</header>

<div class="panel">
  <table>
    <thead>
      <tr>
        <th>Designation</th>
        <th>Close Approach</th>
        <th>Miss Distance (km)</th>
        <th>Lunar Dist</th>
        <th>Velocity (km/s)</th>
        <th>Diameter (m)</th>
        <th>Hazard</th>
        <th>Risk</th>
      </tr>
    </thead>
    <tbody id="neoTable"></tbody>
  </table>
</div>

<footer>
Live data: NASA Near Earth Object API · Monitoring interface prototype
</footer>

</div>

<script>

const NASA_API_KEY = "ACu4bMkSS0dtI2DGh3TnlffpO6FzWxda39ejehWg";

const tableBody = document.getElementById("neoTable");
const statusEl = document.getElementById("status");

const LUNAR_DISTANCE_KM = 384400;

function computeRisk(distanceKm, diameterM, hazardous) {
  let score = 0;

  if (distanceKm < 2000000) score += 2;
  if (distanceKm < 1000000) score += 2;
  if (diameterM > 300) score += 2;
  if (hazardous) score += 3;

  if (score >= 6) return "HIGH";
  if (score >= 4) return "ELEVATED";
  if (score >= 2) return "MODERATE";
  return "LOW";
}

function formatNumber(n) {
  return Number(n).toLocaleString();
}

function formatDecimal(n, digits=2) {
  return Number(n).toFixed(digits);
}

async function loadNEOs() {
  try {
    statusEl.textContent = "Fetching live NEO feed...";

    const today = new Date().toISOString().split("T")[0];

    const response = await fetch(
      `https://api.nasa.gov/neo/rest/v1/feed?start_date=${today}&end_date=${today}&api_key=${NASA_API_KEY}`
    );

    const data = await response.json();

    const neos = data.near_earth_objects[today];

    statusEl.textContent = `${neos.length} objects detected today`;

    neos.sort((a,b) => {
      const d1 = Number(a.close_approach_data[0].miss_distance.kilometers);
      const d2 = Number(b.close_approach_data[0].miss_distance.kilometers);
      return d1 - d2;
    });

    neos.forEach(neo => {
      const approach = neo.close_approach_data[0];

      const distanceKm = Number(approach.miss_distance.kilometers);
      const velocityKmS = Number(approach.relative_velocity.kilometers_per_second);
      const diameterMin = neo.estimated_diameter.meters.estimated_diameter_min;
      const diameterMax = neo.estimated_diameter.meters.estimated_diameter_max;
      const diameterAvg = (diameterMin + diameterMax) / 2;

      const lunarDist = distanceKm / LUNAR_DISTANCE_KM;

      const risk = computeRisk(distanceKm, diameterAvg, neo.is_potentially_hazardous_asteroid);

      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${neo.name}</td>
        <td>${approach.close_approach_date}</td>
        <td>${formatNumber(distanceKm)}</td>
        <td>${formatDecimal(lunarDist,2)} LD</td>
        <td>${formatDecimal(velocityKmS,2)}</td>
        <td>${formatDecimal(diameterAvg,0)}</td>
        <td class="${neo.is_potentially_hazardous_asteroid ? 'hazard' : ''}">
          ${neo.is_potentially_hazardous_asteroid ? 'YES' : 'NO'}
        </td>
        <td>${risk}</td>
      `;

      const detailRow = document.createElement("tr");
      detailRow.classList.add("detail-row");
      detailRow.style.display = "none";

      detailRow.innerHTML = `
        <td colspan="8">
          <div class="detail-content">
            Absolute Magnitude: ${neo.absolute_magnitude_h} <br>
            Diameter Range: ${formatDecimal(diameterMin,1)}m – ${formatDecimal(diameterMax,1)}m <br>
            Approach Time: ${approach.close_approach_date_full} <br>
            Miss Distance: ${formatNumber(distanceKm)} km (${formatDecimal(lunarDist,2)} lunar distances) <br>
            Velocity: ${formatDecimal(velocityKmS,2)} km/s
          </div>
        </td>
      `;

      row.addEventListener("click", () => {
        detailRow.style.display =
          detailRow.style.display === "none" ? "table-row" : "none";
      });

      tableBody.appendChild(row);
      tableBody.appendChild(detailRow);
    });

  } catch (err) {
    statusEl.textContent = "Error loading NEO data";
    console.error(err);
  }
}

loadNEOs();

</script>

</body>
</html>
